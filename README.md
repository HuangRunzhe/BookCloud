# 📚 书云 - 智能图书管理系统

一个现代化的个人图书管理系统，支持图书管理、数据统计、AI问答、批量操作等功能。让您的图书收藏管理更简单高效。

## ✨ 主要功能

- 📚 **图书管理**：添加、编辑、删除、搜索图书
- 📊 **数据统计**：藏书总数、分类统计、阅读进度可视化
- 🤖 **AI问答**：基于DeepSeek的智能问答和推荐
- 🖼️ **封面管理**：支持上传和展示图书封面
- 📱 **批量添加**：支持批量添加多本图书
- 🏆 **排行榜**：用户藏书量排行榜，支持查看其他用户收藏
- 💳 **会员系统**：支持月费(¥12.9)和年费(¥129)会员
- 🔐 **权限管理**：管理员可控制用户使用权限
- 💰 **支付功能**：支持微信支付和支付宝
- 🎨 **响应式设计**：适配各种设备

## 🛠️ 技术栈

- **前端**：Next.js 14 + TypeScript + Tailwind CSS
- **后端**：FastAPI + SQLAlchemy + Python
- **数据库**：SQLite（开发）/ PostgreSQL（生产）
- **AI功能**：DeepSeek API
- **外部API**：Open Library API

## 🚀 快速启动

### 1. 安装依赖

```bash
# 前端依赖
npm install

# 后端依赖（推荐使用智能安装脚本）
cd backend
python install_basic.py

# 或手动安装基础版本
pip install -r requirements-basic.txt

# 或完整版本（包含所有功能）
pip install -r requirements.txt
```

### 2. 启动服务

```bash
# 后端服务
cd backend


# 前端服务
npm run dev
```

### 3. 访问应用

- **前端**：http://localhost:3000
- **后端API**：http://localhost:8000
- **API文档**：http://localhost:8000/docs

## 📖 使用指南

### 基础功能

#### 1. 添加图书
- **单个添加**：点击"添加图书" → 填写信息 → 保存
- **批量添加**：点击"批量添加" → 添加多本图书 → 批量保存
- **手动输入**：直接输入ISBN码 → 自动获取图书信息

#### 2. 浏览图书
- **网格视图**：首页展示所有图书
- **搜索筛选**：按关键词、分类、状态筛选
- **详情查看**：点击图书卡片查看详细信息

#### 3. 编辑图书
- **修改信息**：在详情页点击"编辑"
- **更换封面**：重新上传封面图片
- **更新状态**：修改阅读状态

### 高级功能

#### 1. AI问答
- **智能问答**：在右侧AI助手面板提问
- **图书推荐**：AI会根据您的藏书推荐图书
- **统计查询**：询问藏书统计信息

#### 2. 数据统计
- **藏书总数**：显示总藏书量
- **阅读进度**：已读/未读统计
- **分类分布**：各类别图书数量图表
- **可视化图表**：饼图、柱状图展示

#### 3. 排行榜功能
- **用户排行**：查看所有用户的藏书量排名
- **用户主页**：点击用户查看其公开图书收藏
- **社交互动**：发现其他用户的图书收藏

## 🔧 开发指南

### 项目结构

```
Book/
├── app/                    # Next.js 应用
│   ├── page.tsx           # 首页
│   ├── add/               # 添加图书页面
│   ├── batch-add/         # 批量添加页面
│   ├── leaderboard/       # 排行榜页面
│   ├── admin/             # 管理员页面
│   ├── payment/           # 充值页面
│   ├── user/[id]/         # 用户主页
│   └── book/[id]/         # 图书详情和编辑页面
├── components/            # React 组件
│   ├── BookCard.tsx       # 图书卡片
│   ├── BookGrid.tsx       # 图书网格
│   ├── StatsPanel.tsx     # 统计面板
│   ├── AIChat.tsx         # AI对话组件
│   ├── PublicLeaderboard.tsx # 公开排行榜组件
│   ├── PermissionGuard.tsx # 权限守卫组件
│   └── Header.tsx         # 头部组件
├── lib/                   # 工具库
│   ├── api.ts            # API 调用函数
│   └── utils.ts          # 工具函数
├── types/                 # TypeScript 类型定义
├── backend/               # FastAPI 后端
│   ├── main.py           # 主应用文件
│   ├── models.py         # 数据库模型
│   ├── schemas.py        # Pydantic 模式
│   ├── database.py       # 数据库配置
│   ├── ai_module.py      # AI 处理模块
│   ├── migrate.py        # 数据库迁移脚本
│   └── requirements.txt  # Python 依赖
└── README.md
```

### 开发命令

#### 前端开发
```bash
# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 启动生产服务器
npm start

# 代码检查
npm run lint
```

#### 后端开发
```bash
# 启动开发服务器
uvicorn main:app --reload

# 启动生产服务器
uvicorn main:app --host 0.0.0.0 --port 8000

# 数据库迁移
python migrate.py
```

## 📱 手机访问

### 局域网访问配置

1. **启动服务**：
   ```bash
   # 后端服务
   cd backend
   uvicorn main:app --reload --host 0.0.0.0 --port 8000
   
   # 前端服务
   npm run dev -- --hostname 0.0.0.0
   ```

2. **访问地址**：
   - 电脑访问：http://localhost:3000
   - 手机访问：http://192.168.5.15:3000（替换为您的电脑IP）

### 手机测试功能

- ✅ 访问网页界面
- ✅ 浏览图书列表
- ✅ 查看图书详情
- ✅ 添加新图书
- ✅ 上传封面图片
- ✅ 批量添加功能
- ✅ AI问答功能
- ✅ 排行榜功能

## 🐛 常见问题

### 1. 端口冲突
**问题**：端口 3000 或 8000 被占用
**解决**：
```bash
# 查看端口占用
netstat -ano | findstr :3000
netstat -ano | findstr :8000

# 杀死进程
taskkill /PID <进程ID> /F

# 或使用其他端口
npm run dev -- -p 3001
uvicorn main:app --port 8001
```

### 2. 依赖安装失败
**问题**：npm install 或 pip install 失败
**解决**：
```bash
# 清理缓存
npm cache clean --force
pip cache purge

# 删除 node_modules 重新安装
rm -rf node_modules
npm install

# 使用国内镜像
npm config set registry https://registry.npmmirror.com
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
```

### 3. 图片上传失败
**问题**：封面图片无法显示
**解决**：
- 检查 `uploads` 目录是否存在
- 确认文件权限正确
- 检查图片格式是否支持

### 4. AI功能不可用
**问题**：AI问答或自动生成功能失效
**解决**：
- 检查网络连接
- 确认DeepSeek API密钥有效
- 查看后端日志错误信息

### 5. 手机无法访问
**问题**：手机无法访问网页
**解决**：
1. 确保手机和电脑在同一WiFi网络
2. 检查Windows防火墙设置
3. 确认服务已绑定到0.0.0.0

## 🔐 权限管理和充值系统

### 会员系统
- **免费用户**：基础功能，可添加和管理图书
- **月费会员**：¥12.9/月，享受所有功能
- **年费会员**：¥129/年，相当于月费8折
- **终身会员**：一次性付费，永久享受所有功能

### 支付方式
- **微信支付**：扫描二维码完成支付
- **支付宝**：扫描二维码完成支付

### 管理员功能
- **用户管理**：查看所有用户列表和状态
- **权限控制**：控制用户是否有使用系统的权限
- **支付记录**：查看所有支付记录和状态
- **会员管理**：修改用户会员状态和到期时间

### 权限控制
- 所有图书管理功能都需要权限检查
- 无权限用户会看到升级提示页面
- 会员过期会自动降级为免费用户
- 管理员可以随时启用/禁用用户权限

### 数据库结构
详细的数据库结构请参考：[数据库结构文档.md](./数据库结构文档.md)

## 📊 系统监控

## 📊 性能优化

### 图片压缩
- 自动压缩上传的图片（长边≤800px，质量85%）
- 生成缩略图（长边≤400px，质量80%）
- 大幅减少存储空间占用（通常压缩90%以上）

### 前端优化
- 使用 Next.js 图片优化
- 实现组件懒加载
- 优化包大小

### 后端优化
- 数据库查询优化
- 添加缓存机制
- 异步处理大文件

## 🔒 安全配置

### 生产环境
- 使用环境变量存储敏感信息
- 配置HTTPS
- 设置CORS策略
- 添加请求限流

### 数据备份
```bash
# SQLite备份
cp backend/books.db backup/books_$(date +%Y%m%d).db

# PostgreSQL备份
pg_dump books_db > backup/books_$(date +%Y%m%d).sql
```

## 🚀 部署指南

### 本地部署
1. 按照快速启动步骤操作
2. 确保所有服务正常运行
3. 访问 http://localhost:3000

### 服务器部署
1. 安装Docker和Docker Compose
2. 配置生产环境变量
3. 使用Nginx反向代理
4. 配置SSL证书

## 📈 监控和日志

### 日志配置
- 后端日志：查看控制台输出
- 前端日志：浏览器开发者工具
- 错误追踪：添加错误监控服务

### 性能监控
- 数据库查询性能
- API响应时间
- 内存使用情况

## 🎯 核心特性

### 智能图书管理
- 手动添加图书，简单易用
- 自动获取图书信息
- 批量操作，提高效率

### 数据可视化
- 藏书统计图表
- 分类分布分析
- 阅读进度跟踪

### AI助手
- 智能问答系统
- 个性化图书推荐
- 自然语言查询

### 社交功能
- 用户排行榜
- 公开图书收藏
- 发现其他用户

## 📞 技术支持

如果遇到问题，请：
1. 查看本文档的常见问题部分
2. 检查控制台错误信息
3. 查看项目README文件
4. 提交Issue到项目仓库

## 🎉 开始使用

现在您已经了解了如何启动和使用书云图书管理系统！

1. 按照快速启动步骤启动项目
2. 访问 http://localhost:3000
3. 开始添加您的第一本图书
4. 体验AI问答和排行榜功能

祝您使用愉快！📚✨

## 📄 许可证

MIT License

---

**开始使用**：按照快速启动步骤操作，或查看详细的项目启动指南文档。